<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.skkuwhere.app.mapper.BuildingMapper">
    <select id="searchByCode" parameterType="int" resultType="com.skkuwhere.app.vo.BuildingVO">
        SELECT
            B.code, B.name
        FROM skkuwhere.Building B
        WHERE B.code = #{code};
    </select>
    
    <update id="countUp" >
        UPDATE skkuwhere.ROOMS r
        SET r.r_people = r.r_people + 1
        WHERE r.r_building_code = 26318;
    </update>

    <update id="countDown" >
        UPDATE skkuwhere.ROOMS r
        SET r.r_people = r.r_people - 1
        WHERE r.r_building_code = 26318;
    </update>

    <select id="getScRoomCnt" resultType="com.skkuwhere.app.vo.ScRoomVO">
        SELECT
            r.r_people
        FROM skkuwhere.ROOMS r
        WHERE r.r_building_code = 26318;
    </select>

    <update id="updatePeopleCntToZero">
        UPDATE skkuwhere.SC_ROOM sc
        SET
            sc.people = 0;
    </update>

    <select id="getPeopleCntByCode" parameterType="int" resultType="com.skkuwhere.app.vo.CongestionVO">
        SELECT
            r.r_people,r.r_seat
        FROM
            skkuwhere.ROOMS r
        WHERE
            r.r_building_code = #{code};
    </select>
    
    <update id="updatePeopleByRoomType" parameterType="map">
        UPDATE skkuwhere.ROOMS r
        SET r.r_people = #{people}
        WHERE r.r_room_type = #{roomType};
    </update>
    <select id="getBuildingCodeAndSeat" resultType="com.skkuwhere.app.vo.RoomVO" >
        SELECT
            r.r_building_code,r.r_seat
        FROM
            skkuwhere.ROOMS r ;

    </select>
    <update id="updatePeopleByRandom" parameterType="com.skkuwhere.app.vo.RoomVO">
        UPDATE skkuwhere.ROOMS
        SET r_people = #{r_people}
        WHERE r_building_code = #{r_building_code};
    </update>
    <insert id="updateLog" parameterType="com.skkuwhere.app.vo.RoomVO">
        INSERT INTO skkuwhere.ROOMS_LOG
        (rl_building_code,rl_people)
        VALUES
        (
         #{r_building_code},#{r_people}
        );
    </insert>

    <select id="findRecentLogsForAllBuildings" resultType="com.skkuwhere.app.vo.RoomLogVO">
        SELECT rl_building_code, rl_people, rl_log_time
        FROM skkuwhere.ROOMS_LOG
        ORDER BY rl_log_time DESC
            LIMIT 112
    </select>
</mapper>
